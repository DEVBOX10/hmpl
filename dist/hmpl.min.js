!function(e,t){"object"==typeof module&&module.exports?module.exports=t():"function"==typeof define&&define.amd?define([],t):e.hmpl=e.hmpl||t()}("undefined"!=typeof self?self:this,(function(){return function(){"use strict";const e=e=>"object"==typeof e&&!Array.isArray(e)&&null!==e,t=e=>"[object Function]"===Object.prototype.toString.call(e),o=e=>{throw new Error(e)},n=e=>{console.warn(e)},r="src",s="method",i="initId",l="after",d="repeat",c="memo",a="indicators",p="autoBody",f="hmpl",h="formData",u="disallowedTags",m="sanitize",y="allowedContentTypes",g="get",$="BadResponseError",b="RequestInitError",v="RenderError",w="RequestObjectError",T="CompileOptionsError",N="ParseError",P="CompileError",E={formData:!0},O={formData:!1},j=/(\{\{(?:.|\n|\r)*?\}\}|\{\s*\{(?:.|\n|\r)*?\}\s*\})/g,k=/([{}])|([^{}]+)/g,x=[r,s,i,l,d,a,c,p,y,u,m],I=[100,101,102,103,300,301,302,303,304,305,306,307,308,400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,421,422,423,424,425,426,428,429,431,451,500,501,502,503,504,505,506,507,508,510,511],C=["script","style","iframe"],A=["text/html"],D=[],q=(e,t=!1)=>{let o=e;t&&(o=DOMPurify.sanitize(e));return(new DOMParser).parseFromString(`<template>${o}</template>`,"text/html").childNodes[0].childNodes[0].firstChild},R=(t,r,s,i,l,d,c,a,p={},f,h,u,m,y,g)=>{const{mode:v,cache:w,redirect:T,get:N,referrerPolicy:P,signal:E,credentials:O,timeout:j,referrer:k,headers:x,body:I,window:C,integrity:A}=p,D={method:i.toUpperCase()};void 0!==O&&(D.credentials=O),void 0!==I&&(D.body=I),void 0!==v&&(D.mode=v),void 0!==w&&(D.cache=w),void 0!==T&&(D.redirect=T),void 0!==P&&(D.referrerPolicy=P),void 0!==A&&(D.integrity=A),void 0!==k&&(D.referrer=k);const R=void 0!==E;if(R&&(D.signal=E),void 0!==C&&(D.window=C),void 0!==p.keepalive&&n(`${b}: The "keepalive" property is not yet supported`),x)if(e(x)){const e=new Headers;for(const t in x){const n=x[t],r=typeof n;"string"===r?e.set(t,n):o(`${b}: Expected type string, but received type ${r}`)}D.headers=e}else o(`${b}: The "headers" property must contain a value object`);j&&(R?n(`${b}: The "signal" property overwrote the AbortSignal from "timeout"`):D.signal=AbortSignal.timeout(j));const S=a&&!d&&s?.memo,B=e=>"rejected"===e||"number"==typeof e&&(e<200||e>299),F=e=>{c&&(y.response=e,N?.("response",e,y)),N?.("response",r)},M=(e,o=!0,n=!1)=>{if(d)f.response=e.cloneNode(!0),N?.("response",e);else{let r=[];const i=[...(o?e.cloneNode(!0):e).content.childNodes];if(s.nodes){const e=s.parentNode,t=[],o=s.nodes.length;for(let n=0;n<o;n++){const r=s.nodes[n];if(n===o-1)for(let o=0;o<i.length;o++){const n=i[o],s=e.insertBefore(n,r);t.push(s)}e.removeChild(r)}r=t.slice(),s.nodes=t}else{const e=t.parentNode,o=[],n=i.length;for(let r=0;r<n;r++){const n=i[r],s=e.insertBefore(n,t);o.push(s)}e.removeChild(t),r=o.slice(),s.nodes=o,s.parentNode=e}S&&n&&(s.memo.nodes=s.nodes,s.memo.isPending&&(s.memo.isPending=!1)),F(r)}};let L=!1;const z=()=>{if(d)f.response=void 0,N?.("response",void 0);else if(s?.nodes){const e=s.parentNode,t=s.nodes.length;for(let o=0;o<t;o++){const n=s.nodes[o];o===t-1&&e.insertBefore(s.comment,n),e.removeChild(n)}s.nodes=null,s.parentNode=null,c&&(y.response=void 0,N?.("response",void 0,y)),N?.("response",r)}S&&null!==s.memo.response&&(s.memo.response=null,delete s.memo.isPending,delete s.memo.nodes)},H=e=>{c?y.status!==e&&(y.status=e,N?.("status",e,y)):f.status!==e&&(f.status=e,N?.("status",e)),S&&B(e)&&(s.memo.response=null,delete s.memo.nodes),(e=>{if(g)if(S&&"pending"!==e&&B(e)&&s.memo.isPending&&(s.memo.isPending=!1),"pending"===e){const e=g.pending;void 0!==e&&(S&&(s.memo.isPending=!0),M(e))}else if("rejected"===e){const e=g.rejected;if(void 0!==e)M(e);else{const e=g.error;void 0!==e?M(e):z()}}else{const t=g[`${e}`];if(e>399)if(void 0!==t)M(t);else{const e=g.error;void 0!==e?M(e):z()}else(e<200||e>299)&&(L=!0,void 0!==t?M(t):z())}})(e)};let U=200;H("pending");let G=!0,J=!0;fetch(l,D).then((e=>{if(G=!1,U=e.status,H(U),e.ok||(g&&(J=!1),o(`${$}: Response with status code ${U}`)),Array.isArray(h)&&0!==h.length){const t=e.headers.get("Content-Type");((e,t)=>{if(!e)return!0;let o=!1;for(let n=0;n<t.length;n++){const r=t[n];if(e.includes(r)){o=!0;break}}return!o})(t,h)&&o(`${$}: Expected ${h.map((e=>`"${e}"`)).join(", ")}, but received "${t}"`)}return e.text()})).then((e=>{if(!L){if(S){const{response:t}=s.memo;if(null===t)s.memo.response=e;else{if(t===e)return void(()=>{if(s.memo.isPending){const e=s.parentNode,t=s.memo.nodes,o=s.nodes,n=o.length,r=[];for(let s=0;s<n;s++){const i=o[s];if(s===n-1)for(let o=0;o<t.length;o++){const n=t[o],s=e.insertBefore(n,i);r.push(s)}e.removeChild(i)}s.nodes=r.slice(),s.memo.isPending=!1,s.memo.nodes=r.slice()}const e=s.nodes.slice();F(e)})();s.memo.response=e,delete s.memo.nodes}}const o=((e,t=[],o)=>{const n=q(e,o),r=n.content;for(let e=0;e<t.length;e++){const o=t[e],n=r.querySelectorAll(o);for(let e=0;e<n.length;e++)r.removeChild(n[e])}return n})(e,u,m);if(d)f.response=o,N?.("response",o);else{const e=[],n=[...o.content.childNodes];if(s)M(o,!1,!0);else{const o=t.parentNode;for(let r=0;r<n.length;r++){const s=n[r],i=o.insertBefore(s,t);c&&e.push(i)}o.removeChild(t),c&&(y.response=e,N?.("response",e,y)),N?.("response",r)}}}})).catch((e=>{throw G?(H("rejected"),g||z()):J&&z(),e}))},S=(e,t=!1)=>{const n=t?T:w;"*"===e||((e,t)=>{if(!Array.isArray(e))return!1;let n=!0;for(let r=0;r<e.length;r++)if("string"!=typeof e[r]){o(`${t}: In the array, the element with index ${r} is not a string`),n=!1;break}return n})(e,n)||o(`${n}: Expected "*" or string array, but got neither`)},B=(t,n=!1)=>{const r=e(t),s=n?T:w;if("boolean"==typeof t||r||o(`${s}: Expected a boolean or object, but got neither`),r)for(const e in t)if(e===h)"boolean"!=typeof t[h]&&o(`${s}: The "${h}" property should be a boolean`);else o(`${s}: Unexpected property "${e}"`)},F=(e,t=!1)=>{const n=t?T:w;Array.isArray(e)||o(`${n}: The value of the property "${u}" must be an array`);for(let t=0;t<e.length;t++){const r=e[t];C.includes(r)||o(`${n}: The value "${r}" is not processed`)}},M=(e,t=!1)=>{"boolean"!=typeof e&&o(`${t?T:w}: The value of the property "${m}" must be a boolean`)},L=e=>{e.hasOwnProperty("id")&&e.hasOwnProperty("value")||o(`${b}: Missing "id" or "value" property`)};return{compile:(n,h={})=>{"string"!=typeof n&&o(`${P}: Template was not found or the type of the passed value is not string`),n||o(`${P}: Template must not be a falsey value`),e(h)||o(`${T}: Options must be an object`);const $=!h.hasOwnProperty(c);$||"boolean"==typeof h[c]||o(`${T}: The value of the property ${c} must be a boolean`);const C=!h.hasOwnProperty(p);C||B(h[p],!0);const z=!h.hasOwnProperty(y);z||S(h[y],!0);const H=!h.hasOwnProperty(u);H||F(h[u],!0);const U=!h.hasOwnProperty(m);U||M(h[m],!0);const G=[],J=n.split(j).filter(Boolean),V=[];for(const e of n.matchAll(j))V.push(e.index);0===V.length&&o(`${N}: Request object not found`);const W=e=>e=(e=e.trim()).replace(/\r?\n|\r/g,""),_=(e,t)=>{const n=JSON5.parse(e);for(const e in n){const t=n[e];switch(x.includes(e)||o(`${w}: Property "${e}" is not processed`),e){case a:Array.isArray(t)||o(`${w}: The value of the property "${e}" must be an array`);break;case i:"string"!=typeof t&&"number"!=typeof t&&o(`${w}: The value of the property "${e}" must be a string`);break;case c:case d:"boolean"!=typeof t&&o(`${w}: The value of the property "${e}" must be a boolean value`);break;case p:B(t);break;case y:S(t);break;case u:F(t);break;case m:M(t);break;default:"string"!=typeof t&&o(`${w}: The value of the property "${e}" must be a string`)}}const r={...n,arrId:t};G.push(r)};let X=0;for(let e=0;e<J.length;e++){const t=J[e];if(V.includes(X)){const n=t.split(k).filter(Boolean);let r=-1,s="",i=!0,l=!1;for(let d=0;d<n.length;d++){const c=n[d],a="}"===c;if("{"===c)i?(i=!1,"{"!==n[d+1]&&d++):s+=c,r++;else if(a){if(1===r&&(l=!0),0===r){_(s,e),r--,X+=t.length;break}r--,s+=c}else l?W(c)&&o(`${N}: There is no empty space between the curly brackets`):s+=c}if(-1!==r){const n=e+1,i=J[n],d=i.split(k).filter(Boolean);let c="";for(let a=0;a<d.length;a++){const p=d[a],f="{"===p;if("}"===p){if(1===r&&(l=!0),0===r){const o=[...d];X+=t.length+i.length,o.splice(0,a+1),J[n]=o.join(""),_(s+c,e),r--,e++;break}r--,c+=p}else f?(c+=p,r++):l?W(p)&&o(`${N}: There is no empty space between the curly brackets`):c+=p}}}else X+=t.length}for(let e=0;e<G.length;e++){const t=G[e],{arrId:o}=t,n=`\x3c!--hmpl${e}--\x3e`;J[o]=n,delete t.arrId}n=J.join("");let K=!1;const Q=(e=>{const t=q(e.trim());(t.content.childNodes.length>1||1!==t.content.children.length&&8!==t.content.childNodes[0].nodeType)&&o(`${v}: Template includes only one node of the Element type or one response object`);const n=e=>{switch(e.nodeType){case Node.ELEMENT_NODE:if("PRE"===e.tagName)return;break;case Node.TEXT_NODE:if(!/\S/.test(e.textContent))return void e.remove()}for(let t=0;t<e.childNodes.length;t++)n(e.childNodes.item(t))};n(t.content.childNodes[0]);let r=t.content.firstElementChild;if(!r){const e=t.content.firstChild;8===e?.nodeType&&(K=!0,r=e)}return r})(n);return((n,i,a,h,g,$,T,P,j,k=!1)=>{const x=(n,i)=>{const a=n[r];if(a){const r=(n[s]||"GET").toLowerCase();if(!(e=>"get"!==e&&"post"!==e&&"put"!==e&&"delete"!==e&&"patch"!==e)(r)){const s=n[l];s&&k&&o(`${v}: EventTarget is undefined`);const f=!n.hasOwnProperty(d),N="all"==(f||n[d]?"all":"one"),x=!n.hasOwnProperty(c);let C=!g&&h[c];x?C&&(s&&N||(C=!1)):s?n[c]?N?C=!0:o(`${w}: Memoization works in the enabled repetition mode`):C=!1:o(`${w}: Memoization works in the enabled repetition mode`);const L=!n.hasOwnProperty(p);let z=!$&&h[p];if(L)!0===z&&(z=E),s||(z=!1);else if(s){let e=n[p];if(B(e),!0===z&&(z=E),!0===e&&(e=E),!1===e)z=!1;else{const t={...!1===z?O:z,...e};z=t}}else z=!1,o(`${w}: The "${p}" property does not work without the "${l}" property`);const H=!n.hasOwnProperty(y);let U=T?A:h[y];if(!H){const e=n[y];S(e),U=e}const G=!n.hasOwnProperty(u);let J=P?D:h[u];if(!G){const e=n[u];F(e),J=e}const V=!n.hasOwnProperty(m);let W=!j&&h[m];if(!V){const e=n[m];M(e),W=e}const _=n.initId,X=n.nodeId;let K=n.indicators;if(K){const e=e=>{const{trigger:t,content:n}=e;t||o(`${w}: Failed to activate or detect the indicator`),n||o(`${w}: Failed to activate or detect the indicator`),-1===I.indexOf(t)&&"pending"!==t&&"rejected"!==t&&"error"!==t&&o(`${w}: Failed to activate or detect the indicator`);const r=q(n);return{...e,content:r}},t={},n=[];for(let r=0;r<K.length;r++){const s=e(K[r]),{trigger:i}=s;-1===n.indexOf(i)?n.push(i):o(`${w}: Indicator trigger must be unique`),t[`${i}`]=s.content}K=t}const Q=(e,t=!1)=>{if(t){if(_){let t;for(let o=0;o<e.length;o++){const n=e[o];if(n.id===_){t=n.value;break}}return t||o(`${w}: ID referenced by request not found`),t}return{}}return _&&o(`${w}: ID referenced by request not found`),e},Y=N&&s,Z=(n,s,l,d,c,p=!1,f,h=!1,u,m)=>{const y=d.currentId;if(k)n||(n=i);else if(!n){let e;const{els:t}=d;for(let o=0;o<t.length;o++){const n=t[o];if(n.id===X){u=n,e=n.el;break}}n=e}let g;k||(Y||K)&&(g=u.objNode,g||(g={id:y,nodes:null,parentNode:null,comment:n},C&&(g.memo={response:null},K&&(g.memo.isPending=!1)),u.objNode=g,d.dataObjects.push(g),d.currentId++));let $=Q(s,p);const v=t($);if(!v&&$&&($={...$}),z&&z.formData&&m&&!v){const{type:e,target:t}=m;"submit"===e&&t&&t instanceof HTMLFormElement&&"FORM"===t.nodeName&&($.body=new FormData(t,m.submitter))}const w=v?((e,t)=>{const o={};return void 0!==t&&(o.event=t),e({request:o})})($,m):$;e(w)||void 0===w||o(`${b}: Expected an object with initialization options`),R(n,c,g,r,a,k,h,C,w,l,U,J,W,f,K)};let ee=Z;if(s){const e=(e,t,n,r,s,i,l,d,c,a,p)=>{const f=c.querySelectorAll(n);0===f.length&&o(`${v}: Selectors nodes not found`);const h=N?t=>{Z(e,r,s,i,c,l,a,d,p,t)}:o=>{Z(e,r,s,i,c,l,a,d,p,o);for(let e=0;e<f.length;e++)f[e].removeEventListener(t,h)};for(let e=0;e<f.length;e++)f[e].addEventListener(t,h)};if(s.indexOf(":")>0){const t=s.split(":"),o=t[0],n=t.slice(1).join(":");ee=(t,r,s,i,l,d=!1,c,a=!1,p)=>{e(t,o,n,r,s,i,d,a,l,c,p)}}else o(`${w}: The "${l}" property doesn't work without EventTargets`)}else f||o(`${w}: The "${d}" property doesn't work without "${l}" property`);return ee}o(`${w}: The "${s}" property has only GET, POST, PUT, PATCH or DELETE values`)}else o(`${w}: The "${r}" property are not found or empty`)};let C;if(k)a[0].el=n,C=x(a[0]);else{let e=-2;const t=n=>{if(e++,8==n.nodeType){let t=n.nodeValue;if(t&&t.startsWith(f)){t=t.slice(4);const r=Number(t),s=a[r];(Number.isNaN(r)||void 0===s)&&o(`${N}: Request object with id "${r}" not found`),s.el=n,s.nodeId=e}}if(n.hasChildNodes()){const e=n.childNodes;for(let o=0;o<e.length;o++)t(e[o])}};if(t(n),a.length>1){const e=[];for(let t=0;t<a.length;t++){const o=a[t];e.push(x(o,n))}C=(t,o,n,r,s,i=!1)=>{t||(t=s);const l=[],d=r.els;for(let s=0;s<d.length;s++){const c=d[s],a=c.el,p={response:void 0};(0,e[s])(a,o,n,r,t,i,p,!0,c),l.push(p)}n.requests=l}}else C=x(a[0],n)}return i(C)})(Q,(n=>(r={})=>{const s=Q.cloneNode(!0),i={response:K?void 0:s},l={dataObjects:[],els:[],currentId:0};if(!K){let e=-2;const t=o=>{if(e++,8==o.nodeType){const t=o.nodeValue;if(t&&t.startsWith(f)){const t={el:o,id:e};l.els.push(t)}}if(o.hasChildNodes()){const e=o.childNodes;for(let o=0;o<e.length;o++)t(e[o])}};t(s)}var d;return e(r)||t(r)?(e(d=r)&&d.hasOwnProperty(`${g}`)&&(t(d[g])||o(`${b}: The "${g}" property has a function value`)),n(void 0,r,i,l,s)):Array.isArray(r)?((t=>{const n=[];for(let r=0;r<t.length;r++){const s=t[r];e(s)||o(`${b}: IdentificationRequestInit is of type object`),L(s);const{id:i}=s,l="string"==typeof s.id;l||"number"==typeof s.id||o(`${b}: ID must be a string or a number`),n.indexOf(i)>-1?o(`${b}: ID with value ${l?`"${i}"`:i} already exists`):n.push(i)}})(r),n(void 0,r,i,l,s,!0)):o(`${b}: The type of the value being passed does not match the supported types for RequestInit`),i}),G,h,$,C,z,H,U,K)},stringify:e=>JSON5.stringify(e)}}()}));